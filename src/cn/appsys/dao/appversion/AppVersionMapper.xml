<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.appsys.dao.appversion.AppVersionMapper">


	<!-- List<AppVersion> getVersionList(); -->
	<select id="getVersionList" resultType="AppVersion">
		select v.id,v.versionNo,v.versionInfo,v.downloadLink,v.versionSize,v.createdBy,v.creationDate,
				v.modifyBy,v.modifyDate,v.apkLocPath,v.apkFileName,
				v.appId,(select i.softwareName from app_info i where i.id=v.appId) as appName,
				v.publishStatus,(select d.valueName from data_dictionary d where d.valueId=v.publishStatus and d.typeCode='APP_STATUS') as publishStatusName
					from app_version v	
	</select>

	<!-- int saveappVersion(AppVersion appVersion); -->
	<update id="saveappVersion" parameterType="AppVersion">
		UPDATE app_version 
		set  
		<if test="appId != null">appId = #{appId},</if>
		<if test="versionInfo != null">versionInfo = #{versionInfo},</if>
		<if test="versionSize != null">versionSize = #{versionSize},</if>
		<if test="modifyBy != null">modifyBy = #{modifyBy},</if>
		<if test="modifyDate != null">modifyDate = #{modifyDate},</if>
		
		<if test="downloadLink != null">downloadLink = #{downloadLink},</if>
		<if test="apkLocPath != null">apkLocPath = #{apkLocPath},</if>
		
		<if test="apkFileName != null">apkFileName = #{apkFileName}</if>
		where id = #{id}
	</update>

	<!-- AppVersion getAppVersionByVersionId(Integer vid); -->
	<select id="getAppVersionByVersionId" resultType="AppVersion">
			SELECT * from app_version WHERE id = #{vid}

	</select>

	<!-- int delVersionByInfoId(@Param("id") Integer id); -->
	<delete id="delVersionByInfoId">
			DELETE FROM app_version 
			WHERE appId = #{id}
	</delete>
	
	<!-- int addVersion(AppVersion appVersion); -->
	<insert id="addVersion">
		insert into app_version(
			<if test="appId != null">appId,</if>
			<if test="versionNo != null">versionNo,</if>
			<if test="versionInfo != null">versionInfo,</if>
			<if test="publishStatus != null">publishStatus,</if>
			<if test="downloadLink != null">downloadLink,</if>
			<if test="versionSize != null">versionSize,</if>
			<if test="createdBy != null">createdBy,</if>
			<if test="creationDate != null">creationDate,</if>
			<if test="modifyBy != null">modifyBy,</if>
			<if test="modifyDate != null">modifyDate,</if>
			<if test="apkLocPath != null">apkLocPath,</if>
			<if test="apkFileName != null">apkFileName</if>) 
			values(
			<if test="appId != null">#{appId},</if>
			<if test="versionNo != null">#{versionNo},</if>
			<if test="versionInfo != null">#{versionInfo},</if>
			<if test="publishStatus != null">#{publishStatus},</if>
			<if test="downloadLink != null">#{downloadLink},</if>
			<if test="versionSize != null">#{versionSize},</if>
			<if test="createdBy != null">#{createdBy},</if>
			<if test="creationDate != null">#{creationDate},</if>
			<if test="modifyBy != null">#{modifyBy},</if>
			<if test="modifyDate != null">#{modifyDate},</if>
			<if test="apkLocPath != null">#{apkLocPath},</if>
			<if test="apkFileName != null">#{apkFileName}</if>
		)
		
	</insert>
	
	<!-- List<AppVersion> getAppVersionByInfoid(@Param("appinfoid") Integer appinfoid); -->
	<select id="getAppVersionByInfoid" resultType="AppVersion">
			SELECT 
		v.id,
		v.appId,
		v.versionNo,
		v.versionInfo,
		v.publishStatus,
		v.downloadLink,
		v.versionSize,
		v.createdBy,
		v.creationDate,
		v.modifyBy,
		v.modifyDate,
		v.apkLocPath,
		v.apkLocPath,
		
		i.softwareName as appName,
		d.valueName as publishStatusName,
		v.apkFileName,
		v.apkLocPath as downloadLink
		
			FROM app_info i,app_version v,data_dictionary d
				WHERE 
					i.id = v.appId
					AND d.typeCode = 'APP_STATUS' AND d.valueId = i.status
					AND i.id = #{appinfoid}
					ORDER BY v.modifyDate DESC
		
	</select>
	
	
</mapper>





